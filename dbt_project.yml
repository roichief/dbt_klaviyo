name: 'klaviyo'
profile: 'databricks'
version: '0.9.0'
config-version: 2
require-dbt-version: [">=1.3.0", "<2.0.0"]

dispatch:
  - macro_namespace: dbt_utils
    search_order: ['spark_utils', 'dbt_utils']

# Vars for the transform package (and passed down to klaviyo_source)
vars:
  # The staging models created by klaviyo_source land here:
  klaviyo_database: 0006_wsg
  klaviyo_schema: default_stg_klaviyo

  klaviyo__email_attribution_lookback: 120
  klaviyo__sms_attribution_lookback: 24

  klaviyo__eligible_attribution_events:
    - 'opened email'
    - 'clicked email'
    - 'clicked sms'

  klaviyo__count_metrics:
    - 'Active on Site'
    - 'Viewed Product'
    - 'Ordered Product'
    - 'Placed Order'
    - 'Refunded Order'
    - 'Received Email'
    - 'Clicked Email'
    - 'Opened Email'
    - 'Marked Email as Spam'
    - 'Unsubscribed'
    - 'Received SMS'
    - 'Clicked SMS'
    - 'Sent SMS'
    - 'Unsubscribed from SMS'

  klaviyo__sum_revenue_metrics:
    - 'Refunded Order'
    - 'Placed Order'
    - 'Ordered Product'
    - 'checkout started'
    - 'cancelled order'

  # Optional passthroughs (keep empty unless you need custom columns)
  klaviyo__event_pass_through_columns: []
  klaviyo__person_pass_through_columns: []

model-paths: ["models"]
packages-install-path: "dbt_packages"

models:
  +materialized: table

  # Final marts/facts will land here (separate from staging)
  klaviyo:
    +schema: fct_klaviyo
